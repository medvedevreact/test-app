"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{4085:(e,t,r)=>{r.d(t,{$:()=>c});var a=r(5155),s=r(2115),i=r(4707),l=r(652),n=r(9602),o=r(7594);let d=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md active:translate-y-[1px] text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 disabled:bg-gray-500",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary text-primary bg-transparent hover:bg-secondary",secondary:"bg-secondary text-primary hover:bg-secondary/50",ghost:"hover:bg-secondary hover:text-secondary-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,asChild:c=!1,children:m,disabled:u,loading:p,...x}=e,g=c?i.DX:"button";return(0,a.jsx)(g,{disabled:u||p,className:(0,n.cn)(d({variant:s,size:l,className:r})),ref:t,...x,children:p?(0,a.jsx)(o.A,{className:"w-5 h-5 animate-spin"}):m})});c.displayName="Button"},2336:(e,t,r)=>{r.d(t,{p:()=>l});var a=r(5155),s=r(2115),i=r(9602);let l=s.forwardRef((e,t)=>{let{className:r,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});l.displayName="Input"},5786:(e,t,r)=>{r.d(t,{A:()=>a});let a=r(2651).A.create({baseURL:"http://localhost:3000/api"})},9602:(e,t,r)=>{r.d(t,{cn:()=>i});var a=r(3463),s=r(9795);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},3939:(e,t,r)=>{r.d(t,{Header:()=>X});var a=r(5155),s=r(2115),i=r(9602);let l=e=>{let{className:t,children:r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("mx-auto max-w-[1280px]",t),children:r})};var n=r(5565),o=r(4085),d=r(1536),c=r(8173),m=r.n(c),u=r(3100),p=r.n(u),x=r(5786);let g=async e=>{try{return(await x.A.get("/products",{params:{query:e}})).data}catch(e){throw console.error("Error fetching data:",e),e}},f=e=>{let{className:t}=e,[r,l]=(0,s.useState)(""),[n,o]=(0,s.useState)([]),d=(0,s.useMemo)(()=>p()(async e=>{try{let t=await g(e);o(t)}catch(e){console.error("Error fetching data:",e)}},500),[]);return(0,s.useEffect)(()=>(r?d(r):o([]),()=>{d.cancel()}),[r,d]),(0,a.jsxs)("div",{className:(0,i.cn)("w-full max-w-[600px] relative z-20",t),children:[(0,a.jsx)("input",{type:"text",className:"h-[40px] bg-gray-100 pl-4 w-full rounded-md outline-none z-20 relative",placeholder:"Введите название...",value:r,onChange:e=>{l(e.target.value)}}),r&&(null==n?void 0:n.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-19"}),(0,a.jsx)("ul",{className:"absolute left-0 right-0 top-full mt-2 bg-white border border-gray-200 rounded-md shadow-md z-20",children:n.map(e=>(0,a.jsxs)("div",{className:"px-4 py-2 hover:bg-gray-100 flex items-center gap-4 cursor-pointer rounded-sm",children:[(0,a.jsx)("img",{className:"w-[40px]",src:e.imageUrl,alt:""}),(0,a.jsx)("p",{children:e.name})]},e.id))})]})]})};var h=r(1298),y=r(652),j=r(767);let v=h.bL,b=h.l9;h.bm;let N=h.ZL,w=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(h.hJ,{className:(0,i.cn)("fixed inset-0 z-40 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t})});w.displayName=h.hJ.displayName;let z=(0,y.F)("fixed z-50 gap-4 bg-white p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),S=s.forwardRef((e,t)=>{let{side:r="right",className:s,children:l,...n}=e;return(0,a.jsxs)(N,{children:[(0,a.jsx)(w,{}),(0,a.jsxs)(h.UC,{ref:t,className:(0,i.cn)(z({side:r}),s),...n,children:[(0,a.jsxs)(h.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),l]})]})});S.displayName=h.UC.displayName;let I=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...r})};I.displayName="SheetHeader";let k=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};k.displayName="SheetFooter";let C=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(h.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold text-foreground",r),...s})});C.displayName=h.hE.displayName,s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(h.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})}).displayName=h.VY.displayName;var A=r(9053),q=r(5686);let U=e=>{let{imageUrl:t,name:r,price:s,quantity:l,details:n,disabled:o,onClickCountButton:d,onClickRemove:c,className:m}=e;return(0,a.jsxs)("div",{className:(0,i.cn)("flex bg-white p-5 gap-6",{"opacity-50 pointer-events-none":o},m),children:[(0,a.jsx)("img",{src:t,alt:r,className:"w-16 h-16 object-cover"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:r}),(0,a.jsx)("p",{className:"text-gray-500",children:n})]}),(0,a.jsx)("hr",{className:"my-3"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{onClick:()=>d&&d("minus"),className:(0,i.cn)("bg-gray-200 px-2 py-1 rounded cursor-pointer",{"opacity-50 pointer-events-none":1===l}),children:"-"}),(0,a.jsx)("span",{children:l}),(0,a.jsx)("div",{onClick:()=>d&&d("plus"),className:"bg-gray-200 px-2 py-1 rounded cursor-pointer",children:"+"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-gray-700",children:["₽ ",s.toFixed(2)]}),(0,a.jsx)("div",{onClick:c,className:"text-gray-400 cursor-pointer hover:text-gray-600",children:(0,a.jsx)(q.A,{size:16})})]})]})]})]})};var E=r(5128),$=r(5037),R=r(8474);let P=[{name:"Маленькая",value:"20"},{name:"Средняя",value:"30"},{name:"Большая",value:"40"}],V=[{name:"Традиционное",value:"1"},{name:"Тонкое",value:"2"}],F=e=>{let{children:t}=e,{items:r,totalAmount:i,fetchCartItems:l,error:n,updateItemQuantity:d,removeCartItem:c}=(0,E.x)();if((0,s.useEffect)(()=>{l()},[l]),n)return(0,a.jsx)("div",{children:"Error loading cart items."});let u=e=>{var t,r;let s=null==P?void 0:null===(t=P.find(t=>{var r;return t.value===(null===(r=e.pizzaSize)||void 0===r?void 0:r.toString())}))||void 0===t?void 0:t.name,i=null==V?void 0:null===(r=V.find(t=>{var r;return t.value===(null===(r=e.type)||void 0===r?void 0:r.toString())}))||void 0===r?void 0:r.name,l=null==e?void 0:e.ingredients.map(e=>null==e?void 0:e.name).join(", ");return(0,a.jsxs)(a.Fragment,{children:["Размер: ",s||"-",(0,a.jsx)("br",{}),"Тип теста: ",i||"-",(0,a.jsx)("br",{}),"Ингредиенты: ",l||"-"]})};return(0,a.jsxs)(v,{children:[(0,a.jsx)(b,{asChild:!0,children:t}),(0,a.jsxs)(S,{className:"flex flex-col justify-between",children:[(0,a.jsx)(I,{children:r.length>0&&(0,a.jsxs)(C,{children:["В корзине ",(0,a.jsxs)("span",{className:"font-bold",children:[r.length," товара"]})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===r.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,a.jsx)("p",{className:"text-lg text-neutral-500",children:"Корзина пуста"}),(0,a.jsx)(R.A,{className:"w-12 h-12 text-neutral-300 mt-4"})]}):r.map((e,t)=>(0,a.jsx)(U,{imageUrl:e.imageUrl,name:e.name,price:e.price,quantity:e.quantity,details:u(e),onClickCountButton:t=>{let r="plus"===t?e.quantity+1:e.quantity-1;d(e.id,r)},onClickRemove:async()=>{try{await c(e.id),$.Ay.success("Элемент успешно удален из корзины!")}catch(e){$.Ay.error("Удаление не удалось. Пожалуйста, повторите попытку.")}},className:"mb-4"},e.id))}),r.length>0&&(0,a.jsx)(k,{className:"-mx-6 bg-white p-8",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex mb-4",children:[(0,a.jsxs)("span",{className:"flex flex-1 text-lg text-neutral-500",children:["Итого",(0,a.jsx)("div",{className:"flex-1 border-b border-dashed border-b-neutral-200 relative -top-1 mx-2"})]}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[i," ₽"]})]}),(0,a.jsx)(m(),{href:"/checkout",children:(0,a.jsxs)(o.$,{className:"w-full h-12 text-base",children:["Оформить заказ",(0,a.jsx)(A.A,{className:"w-5 ml-2"})]})})]})})]})]})},L=e=>{let{className:t}=e;return(0,a.jsx)("div",{className:(0,i.cn)(t),children:(0,a.jsx)(F,{children:(0,a.jsx)(o.$,{variant:"outline",children:(0,a.jsx)(d.AsH,{})})})})};var T=r(6046),_=r(2615);let D=e=>{let{isOpen:t,onClose:r,children:s}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[(0,a.jsx)("button",{className:"absolute top-2 right-2",onClick:r,children:"\xd7"}),s]})}):null};var H=r(2336),B=r(9606),G=r(3415);let J=G.z.object({email:G.z.string().email({message:"Введите корректную почту"}),password:G.z.string().min(6,{message:"Введите корректный пароль"})}),M=J.merge(G.z.object({confirmPassword:G.z.string().min(6,{message:"Введите корректный пароль"})})).refine(e=>e.password===e.confirmPassword,{message:"Пароли не совпадают",path:["confirmPassword"]});var O=r(2679),Q=r(5828);let Y=(0,Q.createServerReference)("40eb6bcbc513061ec6f8213df1ba54ca5fb9a46eed",Q.callServer,void 0,Q.findSourceMapURL,"registerUser"),X=e=>{let{className:t,hasSearch:r=!0}=e,c=(0,T.useRouter)(),u=(0,T.useSearchParams)(),{data:p}=(0,_.useSession)(),[x,g]=(0,s.useState)(!1),[h,y]=(0,s.useState)(!1),j=(0,B.mN)({resolver:(0,O.u)(J),defaultValues:{email:"",password:""}}),v=(0,B.mN)({resolver:(0,O.u)(M),defaultValues:{email:"",password:"",confirmPassword:""}});(0,s.useEffect)(()=>{let e="";u.has("paid")&&(e="Заказ успешно оплачен! Информация отправлена на почту."),u.has("verified")&&(e="Почта успешно подтверждена!"),e&&setTimeout(()=>{c.replace("/"),$.Ay.success(e,{duration:3e3})},1e3)},[u,c]);let b=async e=>{try{let t=await (0,_.signIn)("credentials",{...e,redirect:!1});(null==t?void 0:t.error)?$.Ay.error(t.error):g(!1)}catch(e){console.log(e),$.Ay.error("Ошибка при входе. Пожалуйста, попробуйте снова.")}},N=async e=>{try{await Y({email:e.email,fullName:"Иван Иванов",password:e.password}),$.Ay.error("Регистрация успешна \uD83D\uDCDD. Подтвердите свою почту",{icon:"✅"})}catch(e){console.log(e),$.Ay.error("Ошибка при регистрации. Пожалуйста, попробуйте снова.")}};return(0,a.jsxs)("header",{className:(0,i.cn)("border border-b ",t),children:[(0,a.jsxs)(l,{className:"flex items-center justify-between py-8",children:[(0,a.jsx)(m(),{href:"/",children:(0,a.jsxs)("div",{className:"flex gap-2 cursor-pointer",children:[(0,a.jsx)(n.default,{src:"/img/Логотип.png",alt:"Logo Image",width:35,height:35}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl uppercase font-black",children:"Next Pizza"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 leading-3",children:"вкусней уже некуда"})]})]})}),r&&(0,a.jsx)(f,{}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)(o.$,{variant:"outline",onClick:()=>{p?(0,_.signOut)():g(!0)},children:[(0,a.jsx)(d.x$1,{})," ",p?"Выйти":"Войти"]}),r&&(0,a.jsx)(L,{})]})]}),(0,a.jsx)(D,{isOpen:x,onClose:()=>g(!1),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:h?"Регистрация":"Войти"}),(0,a.jsx)("p",{className:"mb-4",children:h?"Пожалуйста, зарегистрируйтесь.":"Пожалуйста, войдите в свою учетную запись."}),h?(0,a.jsxs)("form",{onSubmit:v.handleSubmit(N),children:[(0,a.jsx)(H.p,{placeholder:"Ваша почта...",className:"mb-2",type:"text",...v.register("email")}),v.formState.errors.email&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:v.formState.errors.email.message}),(0,a.jsx)(H.p,{placeholder:"Ваш пароль...",className:"mb-2",type:"password",...v.register("password")}),v.formState.errors.password&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:v.formState.errors.password.message}),(0,a.jsx)(H.p,{placeholder:"Подтвердите пароль...",className:"mb-2",type:"password",...v.register("confirmPassword")}),v.formState.errors.confirmPassword&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:v.formState.errors.confirmPassword.message}),(0,a.jsxs)(o.$,{className:"w-full mb-4 border border-[1px] flex items-center justify-center",onClick:()=>{(0,_.signIn)("google"),g(!1)},variant:"secondary",children:[(0,a.jsx)(d.DSS,{className:"mr-2"}),"Зарегистрироваться с помощью Google"]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>g(!1),children:"Отмена"}),(0,a.jsx)(o.$,{type:"submit",children:"Зарегистрироваться"})]})]}):(0,a.jsxs)("form",{onSubmit:j.handleSubmit(b),children:[(0,a.jsx)(H.p,{placeholder:"Ваша почта...",className:"mb-2",type:"text",...j.register("email")}),j.formState.errors.email&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:j.formState.errors.email.message}),(0,a.jsx)(H.p,{placeholder:"Ваш пароль...",className:"mb-2",type:"password",...j.register("password")}),j.formState.errors.password&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:j.formState.errors.password.message}),(0,a.jsxs)(o.$,{className:"w-full mb-4 border border-[1px] flex items-center justify-center",onClick:()=>{(0,_.signIn)("google"),g(!1)},variant:"secondary",children:[(0,a.jsx)(d.DSS,{className:"mr-2"}),"Войти с помощью Google"]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>g(!1),children:"Отмена"}),(0,a.jsx)(o.$,{type:"submit",children:"Войти"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)(o.$,{variant:"link",onClick:()=>y(!h),children:h?"Уже есть аккаунт? Войти":"Нет аккаунта? Зарегистрироваться"})})]})})]})}},5128:(e,t,r)=>{r.d(t,{x:()=>o});var a=r(5786);let s=async()=>{try{return(await a.A.get("/cart")).data}catch(e){console.log("Error fetching data:",e)}},i=async(e,t)=>{try{return(await a.A.patch("/cart/".concat(e),{quantity:t})).data}catch(e){console.log("Error updating cart item quantity:",e)}},l=async e=>{try{return(await a.A.delete("/cart/".concat(e))).data}catch(e){console.log("Error removing cart item:",e)}},n=async(e,t)=>{try{return(await a.A.post("/cart",{productItemId:e,ingredients:t})).data}catch(e){console.log("Error adding item to cart:",e)}},o=(0,r(9827).v)((e,t)=>({items:[],error:!1,loading:!0,totalAmount:0,fetchCartItems:async()=>{try{e({loading:!0,error:!1});let t=(await s()).items.map(e=>{let t=e.ingredients.reduce((e,t)=>e+t.price,0),r=(e.productItem.price+t)*e.quantity;return{id:e.id,quantity:e.quantity,name:e.productItem.product.name,imageUrl:e.productItem.product.imageUrl,price:r,pizzaSize:e.productItem.size,type:e.productItem.pizzaType,ingredients:e.ingredients}}),r=t.reduce((e,t)=>e+t.price,0);e({items:t,totalAmount:r})}catch(t){console.log(t),e({error:!0})}finally{e({loading:!1})}},removeCartItem:async t=>{try{e({loading:!0,error:!1});let r=(await l(t.toString())).items.map(e=>{let t=e.ingredients.reduce((e,t)=>e+t.price,0),r=(e.productItem.price+t)*e.quantity;return{id:e.id,quantity:e.quantity,name:e.productItem.product.name,imageUrl:e.productItem.product.imageUrl,price:r,pizzaSize:e.productItem.size,type:e.productItem.pizzaType,ingredients:e.ingredients}}),a=r.reduce((e,t)=>e+t.price,0);e({items:r,totalAmount:a})}catch(t){console.log(t),e({error:!0})}finally{e({loading:!1})}},updateItemQuantity:async(t,r)=>{try{e({loading:!0,error:!1});let a=(await i(t.toString(),r)).items.map(e=>{let t=e.ingredients.reduce((e,t)=>e+t.price,0),r=(e.productItem.price+t)*e.quantity;return{id:e.id,quantity:e.quantity,name:e.productItem.product.name,imageUrl:e.productItem.product.imageUrl,price:r,pizzaSize:e.productItem.size,type:e.productItem.pizzaType,ingredients:e.ingredients}}),s=a.reduce((e,t)=>e+t.price,0);e({items:a,totalAmount:s})}catch(t){console.log(t),e({error:!0})}finally{e({loading:!1})}},addCartItem:async t=>{try{e({loading:!0,error:!1});let r=(await n(t.productItemId,t.ingredients)).items.map(e=>{let t=e.ingredients.reduce((e,t)=>e+t.price,0),r=(e.productItem.price+t)*e.quantity;return{id:e.id,quantity:e.quantity,name:e.productItem.product.name,imageUrl:e.productItem.product.imageUrl,price:r,pizzaSize:e.productItem.size,type:e.productItem.pizzaType,ingredients:e.ingredients}}),a=r.reduce((e,t)=>e+t.price,0);e({items:r,totalAmount:a})}catch(t){console.log(t),e({error:!0})}finally{e({loading:!1})}}}))}}]);
(()=>{var e={};e.id=20,e.ids=[20],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},32130:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>u});var s=r(42706),i=r(28203),n=r(45994),o=r(31556),c=r(39187);async function d(e){try{let t=e.cookies.get("cartToken")?.value;if(!t)return c.NextResponse.json({items:[]});let r=await o.z.cart.findFirst({where:{token:t},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}});return c.NextResponse.json(r)}catch(e){console.log(e)}}async function u(e){try{let t=e.cookies.get("cartToken")?.value;t||(t=crypto.randomUUID());let r=await o.z.cart.findFirst({where:{token:t}});r||(r=await o.z.cart.create({data:{token:t}}));let a=await e.json(),s=await o.z.cartItem.findFirst({where:{cartId:r.id,productItemId:a.productItemId,ingredients:{every:{id:{in:a.ingredients}},some:{}}}});s?await o.z.cartItem.update({where:{id:s.id},data:{quantity:s.quantity+1}}):await o.z.cartItem.create({data:{cartId:r.id,productItemId:a.productItemId,ingredients:{connect:a.ingredients?.map(e=>({id:e}))},quantity:1}});let i=await o.z.cart.findFirst({where:{token:t},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}}),n=c.NextResponse.json(i);return e.cookies.get("cartToken")||n.cookies.set("cartToken",t,{httpOnly:!0,maxAge:2592e3,path:"/"}),n}catch(e){return console.log("[CART_POST] Sever error",e),c.NextResponse.json({error:"Internal Server Error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"C:\\Users\\olya_\\OneDrive\\Desktop\\next-pizza\\app\\api\\cart\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:x}=p;function g(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},96487:()=>{},78335:()=>{},31556:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var a=r(96330);let s=globalThis.prismaGlobal??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,452],()=>r(32130));module.exports=a})();